<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jubel - Admin Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-orange: #FF6B35;
            --primary-red: #E74C3C;
            --primary-gradient: linear-gradient(135deg, #FF6B35, #E74C3C);
            --secondary-orange: #E55A28;
            --secondary-red: #C0392B;
            --light-orange: #FFE8E0;
            --light-red: #FADBD8;
            --white: #FFFFFF;
            --light-gray: #F5F5F5;
            --dark-gray: #333333;
            --medium-gray: #777777;
            --success-green: #2ecc71;
            --warning-yellow: #f39c12;
            --info-blue: #3498db;
            --error-red: #e74c3c;
            --border-color: #E8E8E8;
            --shadow-light: 0 2px 12px rgba(255, 107, 53, 0.1);
            --shadow-medium: 0 4px 20px rgba(255, 107, 53, 0.15);
            --shadow-heavy: 0 8px 30px rgba(255, 107, 53, 0.2);
            --app-padding: 12px;
            --element-radius: 8px;
            --transition-speed: 0.3s;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light-gray);
            color: var(--dark-gray);
            min-height: 100vh;
        }

        /* Login Screen */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--white);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .jubel-logo {
            width: 150px;
            height: 150px;
            background: var(--primary-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
            box-shadow: var(--shadow-heavy);
        }

        .jubel-logo-text {
            color: var(--white);
            font-size: 2rem;
            font-weight: 800;
            letter-spacing: 1px;
        }

        .login-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--dark-gray);
            text-align: center;
        }

        .login-form {
            width: 100%;
            max-width: 400px;
            margin-top: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: var(--element-radius);
            font-size: 1rem;
            transition: all var(--transition-speed) ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-orange);
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: var(--element-radius);
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: var(--white);
            width: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-heavy);
        }

        /* Main Admin Dashboard */
        .admin-dashboard {
            display: none;
        }

        /* Header */
        .admin-header {
            background: var(--white);
            box-shadow: var(--shadow-light);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-logo {
            width: 40px;
            height: 40px;
            background: var(--primary-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: 700;
        }

        .header-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--dark-gray);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .admin-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-gradient);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .logout-btn {
            background: var(--error-red);
            color: var(--white);
            padding: 8px 15px;
            border-radius: var(--element-radius);
            font-size: 0.9rem;
            cursor: pointer;
        }

        /* Sidebar */
        .admin-container {
            display: flex;
            min-height: calc(100vh - 70px);
        }

        .admin-sidebar {
            width: 250px;
            background: var(--white);
            border-right: 1px solid var(--border-color);
            padding: 20px 0;
            display: flex;
            flex-direction: column;
        }

        .sidebar-nav {
            flex: 1;
        }

        .nav-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            color: var(--medium-gray);
            text-decoration: none;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background: var(--light-orange);
            color: var(--primary-orange);
        }

        .nav-item.active {
            background: var(--light-orange);
            color: var(--primary-orange);
            border-left-color: var(--primary-orange);
            font-weight: 600;
        }

        .nav-item i {
            width: 20px;
        }

        /* Main Content */
        .admin-main {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .page-header {
            margin-bottom: 25px;
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .page-subtitle {
            color: var(--medium-gray);
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--white);
            border-radius: var(--element-radius);
            padding: 20px;
            box-shadow: var(--shadow-light);
            border-top: 4px solid;
        }

        .stat-card.drivers {
            border-top-color: var(--primary-orange);
        }

        .stat-card.passengers {
            border-top-color: var(--info-blue);
        }

        .stat-card.rides {
            border-top-color: var(--success-green);
        }

        .stat-card.revenue {
            border-top-color: var(--warning-yellow);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: var(--white);
        }

        .stat-icon.drivers {
            background: var(--primary-orange);
        }

        .stat-icon.passengers {
            background: var(--info-blue);
        }

        .stat-icon.rides {
            background: var(--success-green);
        }

        .stat-icon.revenue {
            background: var(--warning-yellow);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--medium-gray);
            font-size: 0.9rem;
        }

        .stat-change {
            font-size: 0.8rem;
            padding: 2px 8px;
            border-radius: 10px;
        }

        .stat-change.positive {
            background: rgba(46, 204, 113, 0.1);
            color: var(--success-green);
        }

        .stat-change.negative {
            background: rgba(231, 76, 60, 0.1);
            color: var(--error-red);
        }

        /* Tables */
        .data-table-container {
            background: var(--white);
            border-radius: var(--element-radius);
            box-shadow: var(--shadow-light);
            overflow: hidden;
        }

        .table-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-size: 1.1rem;
            font-weight: 700;
        }

        .table-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .search-box {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--element-radius);
            font-size: 0.9rem;
        }

        .filter-select {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--element-radius);
            background: var(--white);
            font-size: 0.9rem;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            background: var(--light-gray);
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--dark-gray);
            border-bottom: 1px solid var(--border-color);
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
        }

        .data-table tr:hover {
            background: var(--light-orange);
        }

        /* Status badges */
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
        }

        .status-approved {
            background: rgba(46, 204, 113, 0.1);
            color: var(--success-green);
        }

        .status-pending {
            background: rgba(243, 156, 18, 0.1);
            color: var(--warning-yellow);
        }

        .status-rejected {
            background: rgba(231, 76, 60, 0.1);
            color: var(--error-red);
        }

        .status-online {
            background: rgba(46, 204, 113, 0.1);
            color: var(--success-green);
        }

        .status-offline {
            background: rgba(119, 119, 119, 0.1);
            color: var(--medium-gray);
        }

        /* Action buttons */
        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .action-btn {
            width: 32px;
            height: 32px;
            border-radius: var(--element-radius);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-speed) ease;
        }

        .action-btn.view {
            background: rgba(52, 152, 219, 0.1);
            color: var(--info-blue);
        }

        .action-btn.edit {
            background: rgba(243, 156, 18, 0.1);
            color: var(--warning-yellow);
        }

        .action-btn.delete {
            background: rgba(231, 76, 60, 0.1);
            color: var(--error-red);
        }

        .action-btn.approve {
            background: rgba(46, 204, 113, 0.1);
            color: var(--success-green);
        }

        .action-btn.reject {
            background: rgba(231, 76, 60, 0.1);
            color: var(--error-red);
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-light);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: var(--white);
            border-radius: var(--element-radius);
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-heavy);
            animation: modal-appear 0.3s ease;
        }

        @keyframes modal-appear {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--medium-gray);
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-modal:hover {
            background: var(--light-gray);
        }

        .modal-body {
            padding: 20px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            font-weight: 600;
            color: var(--medium-gray);
            transition: all var(--transition-speed) ease;
        }

        .tab:hover {
            color: var(--primary-orange);
        }

        .tab.active {
            color: var(--primary-orange);
            border-bottom-color: var(--primary-orange);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Detail sections */
        .detail-section {
            margin-bottom: 25px;
        }

        .detail-title {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--dark-gray);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .detail-item {
            background: var(--light-gray);
            padding: 15px;
            border-radius: var(--element-radius);
        }

        .detail-label {
            font-size: 0.8rem;
            color: var(--medium-gray);
            margin-bottom: 5px;
            font-weight: 600;
        }

        .detail-value {
            font-size: 0.9rem;
            font-weight: 600;
        }

        /* Images */
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .image-item {
            position: relative;
            border-radius: var(--element-radius);
            overflow: hidden;
            box-shadow: var(--shadow-light);
        }

        .image-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            display: block;
        }

        .image-label {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            color: var(--white);
            padding: 5px;
            font-size: 0.7rem;
            text-align: center;
        }

        /* Charts */
        .chart-container {
            background: var(--white);
            border-radius: var(--element-radius);
            padding: 20px;
            box-shadow: var(--shadow-light);
            margin-bottom: 30px;
        }

        .chart-placeholder {
            height: 300px;
            background: var(--light-gray);
            border-radius: var(--element-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--medium-gray);
            margin-top: 15px;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            padding: 20px;
            border-top: 1px solid var(--border-color);
        }

        .page-btn {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            background: var(--white);
            border-radius: var(--element-radius);
            cursor: pointer;
            font-size: 0.9rem;
        }

        .page-btn.active {
            background: var(--primary-orange);
            color: var(--white);
            border-color: var(--primary-orange);
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .admin-sidebar {
                width: 200px;
            }
        }

        @media (max-width: 768px) {
            .admin-container {
                flex-direction: column;
            }
            
            .admin-sidebar {
                width: 100%;
                padding: 10px 0;
            }
            
            .sidebar-nav {
                display: flex;
                overflow-x: auto;
            }
            
            .nav-item {
                padding: 10px 15px;
                white-space: nowrap;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 576px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .table-header {
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }
            
            .table-controls {
                flex-direction: column;
            }
            
            .data-table {
                font-size: 0.9rem;
            }
            
            .data-table th,
            .data-table td {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="jubel-logo">
            <div class="jubel-logo-text">J</div>
        </div>
        <h1 class="login-title">Jubel Admin Dashboard</h1>
        <form class="login-form" id="loginForm">
            <div class="form-group">
                <label for="adminEmail" class="form-label">Admin Email</label>
                <input type="email" id="adminEmail" class="form-input" placeholder="admin@jubel.com" required>
            </div>
            <div class="form-group">
                <label for="adminPassword" class="form-label">Password</label>
                <input type="password" id="adminPassword" class="form-input" placeholder="Enter password" required>
            </div>
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-sign-in-alt"></i>
                Login to Dashboard
            </button>
        </form>
    </div>

    <!-- Admin Dashboard -->
    <div class="admin-dashboard" id="adminDashboard">
        <!-- Header -->
        <header class="admin-header">
            <div class="header-left">
                <div class="header-logo">J</div>
                <div class="header-title">Jubel Admin Dashboard</div>
            </div>
            <div class="header-right">
                <div class="admin-info">
                    <div class="admin-avatar" id="adminAvatar">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <div>
                        <div id="adminName">Admin User</div>
                        <div style="font-size: 0.8rem; color: var(--medium-gray);">Super Admin</div>
                    </div>
                </div>
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </button>
            </div>
        </header>

        <!-- Main Container -->
        <div class="admin-container">
            <!-- Sidebar -->
            <nav class="admin-sidebar">
                <div class="sidebar-nav">
                    <a href="#" class="nav-item active" data-page="dashboard">
                        <i class="fas fa-tachometer-alt"></i>
                        Dashboard
                    </a>
                    <a href="#" class="nav-item" data-page="drivers">
                        <i class="fas fa-car"></i>
                        Drivers
                    </a>
                    <a href="#" class="nav-item" data-page="passengers">
                        <i class="fas fa-users"></i>
                        Passengers
                    </a>
                    <a href="#" class="nav-item" data-page="rides">
                        <i class="fas fa-road"></i>
                        Rides
                    </a>
                    <a href="#" class="nav-item" data-page="earnings">
                        <i class="fas fa-chart-line"></i>
                        Earnings
                    </a>
                    <a href="#" class="nav-item" data-page="sos">
                        <i class="fas fa-life-ring"></i>
                        SOS Alerts
                    </a>
                    <a href="#" class="nav-item" data-page="settings">
                        <i class="fas fa-cog"></i>
                        Settings
                    </a>
                </div>
            </nav>

            <!-- Main Content -->
            <main class="admin-main">
                <!-- Dashboard Page -->
                <div class="page-content active" id="dashboardPage">
                    <div class="page-header">
                        <h1 class="page-title">Dashboard Overview</h1>
                        <p class="page-subtitle">Welcome back, Admin! Here's what's happening today.</p>
                    </div>

                    <!-- Stats Cards -->
                    <div class="stats-grid">
                        <div class="stat-card drivers">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-value" id="totalDrivers">0</div>
                                    <div class="stat-label">Total Drivers</div>
                                </div>
                                <div class="stat-icon drivers">
                                    <i class="fas fa-car"></i>
                                </div>
                            </div>
                            <div class="stat-change positive" id="driverChange">
                                <i class="fas fa-arrow-up"></i> 12% from last month
                            </div>
                        </div>

                        <div class="stat-card passengers">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-value" id="totalPassengers">0</div>
                                    <div class="stat-label">Total Passengers</div>
                                </div>
                                <div class="stat-icon passengers">
                                    <i class="fas fa-users"></i>
                                </div>
                            </div>
                            <div class="stat-change positive" id="passengerChange">
                                <i class="fas fa-arrow-up"></i> 8% from last month
                            </div>
                        </div>

                        <div class="stat-card rides">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-value" id="totalRides">0</div>
                                    <div class="stat-label">Rides Today</div>
                                </div>
                                <div class="stat-icon rides">
                                    <i class="fas fa-road"></i>
                                </div>
                            </div>
                            <div class="stat-change positive" id="rideChange">
                                <i class="fas fa-arrow-up"></i> 15% from yesterday
                            </div>
                        </div>

                        <div class="stat-card revenue">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-value" id="totalRevenue">K0.00</div>
                                    <div class="stat-label">Today's Revenue</div>
                                </div>
                                <div class="stat-icon revenue">
                                    <i class="fas fa-money-bill-wave"></i>
                                </div>
                            </div>
                            <div class="stat-change positive" id="revenueChange">
                                <i class="fas fa-arrow-up"></i> 22% from yesterday
                            </div>
                        </div>
                    </div>

                    <!-- Charts -->
                    <div class="chart-container">
                        <h2 class="detail-title">Ride Statistics</h2>
                        <div class="chart-placeholder">
                            Ride Statistics Chart
                        </div>
                    </div>

                    <div class="chart-container">
                        <h2 class="detail-title">Revenue Overview</h2>
                        <div class="chart-placeholder">
                            Revenue Chart
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="data-table-container">
                        <div class="table-header">
                            <div class="table-title">Recent Activity</div>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Type</th>
                                    <th>Description</th>
                                    <th>User</th>
                                    <th>Time</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="recentActivityTable">
                                <!-- Activity rows will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Drivers Page -->
                <div class="page-content" id="driversPage">
                    <div class="page-header">
                        <h1 class="page-title">Driver Management</h1>
                        <p class="page-subtitle">Manage all registered drivers and their approvals</p>
                    </div>

                    <div class="data-table-container">
                        <div class="table-header">
                            <div class="table-title">All Drivers</div>
                            <div class="table-controls">
                                <input type="text" class="search-box" placeholder="Search drivers..." id="driverSearch">
                                <select class="filter-select" id="driverFilter">
                                    <option value="all">All Status</option>
                                    <option value="pending">Pending Approval</option>
                                    <option value="approved">Approved</option>
                                    <option value="rejected">Rejected</option>
                                    <option value="online">Online Now</option>
                                    <option value="offline">Offline</option>
                                </select>
                            </div>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Driver ID</th>
                                    <th>Name</th>
                                    <th>Phone</th>
                                    <th>Vehicle</th>
                                    <th>Registration Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="driversTable">
                                <!-- Driver rows will be populated here -->
                            </tbody>
                        </table>
                        <div class="pagination">
                            <button class="page-btn" id="driverPrevBtn">Previous</button>
                            <span id="driverPageInfo">Page 1 of 1</span>
                            <button class="page-btn" id="driverNextBtn">Next</button>
                        </div>
                    </div>
                </div>

                <!-- Passengers Page -->
                <div class="page-content" id="passengersPage">
                    <div class="page-header">
                        <h1 class="page-title">Passenger Management</h1>
                        <p class="page-subtitle">Manage all registered passengers</p>
                    </div>

                    <div class="data-table-container">
                        <div class="table-header">
                            <div class="table-title">All Passengers</div>
                            <div class="table-controls">
                                <input type="text" class="search-box" placeholder="Search passengers..." id="passengerSearch">
                                <select class="filter-select" id="passengerFilter">
                                    <option value="all">All Passengers</option>
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                            </div>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Passenger ID</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Phone</th>
                                    <th>Total Rides</th>
                                    <th>Join Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="passengersTable">
                                <!-- Passenger rows will be populated here -->
                            </tbody>
                        </table>
                        <div class="pagination">
                            <button class="page-btn" id="passengerPrevBtn">Previous</button>
                            <span id="passengerPageInfo">Page 1 of 1</span>
                            <button class="page-btn" id="passengerNextBtn">Next</button>
                        </div>
                    </div>
                </div>

                <!-- Rides Page -->
                <div class="page-content" id="ridesPage">
                    <div class="page-header">
                        <h1 class="page-title">Ride Management</h1>
                        <p class="page-subtitle">Monitor and manage all rides</p>
                    </div>

                    <div class="data-table-container">
                        <div class="table-header">
                            <div class="table-title">All Rides</div>
                            <div class="table-controls">
                                <input type="text" class="search-box" placeholder="Search rides..." id="rideSearch">
                                <select class="filter-select" id="rideFilter">
                                    <option value="all">All Status</option>
                                    <option value="requested">Requested</option>
                                    <option value="accepted">Accepted</option>
                                    <option value="started">Started</option>
                                    <option value="picked_up">Picked Up</option>
                                    <option value="completed">Completed</option>
                                    <option value="cancelled">Cancelled</option>
                                </select>
                                <input type="date" class="filter-select" id="rideDateFilter">
                            </div>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Ride ID</th>
                                    <th>Passenger</th>
                                    <th>Driver</th>
                                    <th>Pickup</th>
                                    <th>Destination</th>
                                    <th>Fare</th>
                                    <th>Time</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="ridesTable">
                                <!-- Ride rows will be populated here -->
                            </tbody>
                        </table>
                        <div class="pagination">
                            <button class="page-btn" id="ridePrevBtn">Previous</button>
                            <span id="ridePageInfo">Page 1 of 1</span>
                            <button class="page-btn" id="rideNextBtn">Next</button>
                        </div>
                    </div>
                </div>

                <!-- Earnings Page -->
                <div class="page-content" id="earningsPage">
                    <div class="page-header">
                        <h1 class="page-title">Earnings & Commission</h1>
                        <p class="page-subtitle">Monitor platform earnings and commissions</p>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-value" id="totalPlatformEarnings">K0.00</div>
                                    <div class="stat-label">Total Platform Earnings</div>
                                </div>
                                <div class="stat-icon" style="background: var(--success-green);">
                                    <i class="fas fa-money-bill-wave"></i>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-value" id="todayCommission">K0.00</div>
                                    <div class="stat-label">Today's Commission</div>
                                </div>
                                <div class="stat-icon" style="background: var(--warning-yellow);">
                                    <i class="fas fa-percentage"></i>
                                </div>
                            </div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div>
                                    <div class="stat-value" id="monthCommission">K0.00</div>
                                    <div class="stat-label">Monthly Commission</div>
                                </div>
                                <div class="stat-icon" style="background: var(--info-blue);">
                                    <i class="fas fa-calendar-alt"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="data-table-container">
                        <div class="table-header">
                            <div class="table-title">Driver Earnings</div>
                            <div class="table-controls">
                                <select class="filter-select" id="earningsFilter">
                                    <option value="today">Today</option>
                                    <option value="week">This Week</option>
                                    <option value="month">This Month</option>
                                    <option value="all">All Time</option>
                                </select>
                            </div>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Driver</th>
                                    <th>Total Rides</th>
                                    <th>Total Earnings</th>
                                    <th>Commission</th>
                                    <th>Net Earnings</th>
                                    <th>Rating</th>
                                </tr>
                            </thead>
                            <tbody id="earningsTable">
                                <!-- Earnings rows will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- SOS Alerts Page -->
                <div class="page-content" id="sosPage">
                    <div class="page-header">
                        <h1 class="page-title">SOS Emergency Alerts</h1>
                        <p class="page-subtitle">Monitor and respond to emergency alerts</p>
                    </div>

                    <div class="data-table-container">
                        <div class="table-header">
                            <div class="table-title">Active SOS Alerts</div>
                            <div class="table-controls">
                                <select class="filter-select" id="sosFilter">
                                    <option value="active">Active</option>
                                    <option value="resolved">Resolved</option>
                                    <option value="all">All</option>
                                </select>
                            </div>
                        </div>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Alert ID</th>
                                    <th>Driver</th>
                                    <th>Passenger</th>
                                    <th>Time</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="sosTable">
                                <!-- SOS alert rows will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Settings Page -->
                <div class="page-content" id="settingsPage">
                    <div class="page-header">
                        <h1 class="page-title">Settings</h1>
                        <p class="page-subtitle">Configure platform settings</p>
                    </div>

                    <div class="data-table-container">
                        <div class="tabs">
                            <div class="tab active" data-tab="commission">Commission Settings</div>
                            <div class="tab" data-tab="fares">Fare Settings</div>
                            <div class="tab" data-tab="notifications">Notification Settings</div>
                            <div class="tab" data-tab="system">System Settings</div>
                        </div>

                        <div class="tab-content active" id="commissionTab">
                            <div class="detail-section">
                                <h3 class="detail-title">Commission Rates</h3>
                                <div class="detail-grid">
                                    <div class="detail-item">
                                        <div class="detail-label">Standard Commission Rate</div>
                                        <div class="detail-value" id="commissionRate">8%</div>
                                        <button class="btn" style="margin-top: 10px; padding: 8px 12px; font-size: 0.9rem;">Edit</button>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Premium Commission Rate</div>
                                        <div class="detail-value" id="premiumCommissionRate">10%</div>
                                        <button class="btn" style="margin-top: 10px; padding: 8px 12px; font-size: 0.9rem;">Edit</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="tab-content" id="faresTab">
                            <div class="detail-section">
                                <h3 class="detail-title">Base Fares</h3>
                                <div class="detail-grid">
                                    <div class="detail-item">
                                        <div class="detail-label">Car Base Fare</div>
                                        <div class="detail-value" id="carBaseFare">K15.00</div>
                                        <button class="btn" style="margin-top: 10px; padding: 8px 12px; font-size: 0.9rem;">Edit</button>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Bike Base Fare</div>
                                        <div class="detail-value" id="bikeBaseFare">K10.00</div>
                                        <button class="btn" style="margin-top: 10px; padding: 8px 12px; font-size: 0.9rem;">Edit</button>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Bicycle Base Fare</div>
                                        <div class="detail-value" id="bicycleBaseFare">K5.00</div>
                                        <button class="btn" style="margin-top: 10px; padding: 8px 12px; font-size: 0.9rem;">Edit</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="tab-content" id="notificationsTab">
                            <div class="detail-section">
                                <h3 class="detail-title">Email Notifications</h3>
                                <div class="detail-item">
                                    <div class="detail-label">Admin Email</div>
                                    <div class="detail-value" id="adminEmailSetting">admin@jubel.com</div>
                                    <button class="btn" style="margin-top: 10px; padding: 8px 12px; font-size: 0.9rem;">Edit</button>
                                </div>
                            </div>
                        </div>

                        <div class="tab-content" id="systemTab">
                            <div class="detail-section">
                                <h3 class="detail-title">System Information</h3>
                                <div class="detail-grid">
                                    <div class="detail-item">
                                        <div class="detail-label">Platform Version</div>
                                        <div class="detail-value">1.0.0</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Last Updated</div>
                                        <div class="detail-value" id="lastUpdated">2024-01-01</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Total Users</div>
                                        <div class="detail-value" id="totalUsers">0</div>
                                    </div>
                                    <div class="detail-item">
                                        <div class="detail-label">Database Size</div>
                                        <div class="detail-value" id="dbSize">0 MB</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Driver Details Modal -->
    <div class="modal-overlay" id="driverModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Driver Details</div>
                <button class="close-modal" id="closeDriverModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="tabs">
                    <div class="tab active" data-tab="driver-info">Driver Information</div>
                    <div class="tab" data-tab="vehicle-info">Vehicle Information</div>
                    <div class="tab" data-tab="documents">Documents</div>
                    <div class="tab" data-tab="ride-history">Ride History</div>
                </div>

                <div class="tab-content active" id="driver-info-tab">
                    <div class="detail-section">
                        <h3 class="detail-title">Personal Information</h3>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <div class="detail-label">Full Name</div>
                                <div class="detail-value" id="modalDriverName">N/A</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Email Address</div>
                                <div class="detail-value" id="modalDriverEmail">N/A</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Phone Number</div>
                                <div class="detail-value" id="modalDriverPhone">N/A</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">NRC Number</div>
                                <div class="detail-value" id="modalDriverNRC">N/A</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Registration Date</div>
                                <div class="detail-value" id="modalDriverRegDate">N/A</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Status</div>
                                <div class="detail-value" id="modalDriverStatus">N/A</div>
                            </div>
                        </div>
                    </div>

                    <div class="detail-section">
                        <h3 class="detail-title">Account Status</h3>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <div class="detail-label">Registration Status</div>
                                <div class="detail-value" id="modalRegStatus">N/A</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Online Status</div>
                                <div class="detail-value" id="modalOnlineStatus">N/A</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Wallet Balance</div>
                                <div class="detail-value" id="modalWalletBalance">K0.00</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Float Balance</div>
                                <div class="detail-value" id="modalFloatBalance">K0.00</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="vehicle-info-tab">
                    <div class="detail-section">
                        <h3 class="detail-title">Vehicle Details</h3>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <div class="detail-label">Vehicle Type</div>
                                <div class="detail-value" id="modalVehicleType">N/A</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Vehicle Make</div>
                                <div class="detail-value" id="modalVehicleMake">N/A</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Vehicle Model</div>
                                <div class="detail-value" id="modalVehicleModel">N/A</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">License Plate</div>
                                <div class="detail-value" id="modalLicensePlate">N/A</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Year</div>
                                <div class="detail-value" id="modalVehicleYear">N/A</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Color</div>
                                <div class="detail-value" id="modalVehicleColor">N/A</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="documents-tab">
                    <div class="detail-section">
                        <h3 class="detail-title">Uploaded Documents</h3>
                        <div class="image-grid" id="driverDocumentsGrid">
                            <!-- Documents will be populated here -->
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="ride-history-tab">
                    <div class="detail-section">
                        <h3 class="detail-title">Recent Rides</h3>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Ride ID</th>
                                    <th>Date</th>
                                    <th>Passenger</th>
                                    <th>Fare</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="modalDriverRides">
                                <!-- Driver's rides will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Passenger Details Modal -->
    <div class="modal-overlay" id="passengerModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Passenger Details</div>
                <button class="close-modal" id="closePassengerModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="detail-section">
                    <h3 class="detail-title">Personal Information</h3>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">Full Name</div>
                            <div class="detail-value" id="modalPassengerName">N/A</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Email Address</div>
                            <div class="detail-value" id="modalPassengerEmail">N/A</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Phone Number</div>
                            <div class="detail-value" id="modalPassengerPhone">N/A</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Join Date</div>
                            <div class="detail-value" id="modalPassengerJoinDate">N/A</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Total Rides</div>
                            <div class="detail-value" id="modalPassengerTotalRides">0</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Average Rating</div>
                            <div class="detail-value" id="modalPassengerRating">0.0</div>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h3 class="detail-title">Recent Rides</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Ride ID</th>
                                <th>Date</th>
                                <th>Driver</th>
                                <th>Vehicle</th>
                                <th>Fare</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="modalPassengerRides">
                            <!-- Passenger's rides will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Ride Details Modal -->
    <div class="modal-overlay" id="rideModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Ride Details</div>
                <button class="close-modal" id="closeRideModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="detail-section">
                    <h3 class="detail-title">Basic Information</h3>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">Ride ID</div>
                            <div class="detail-value" id="modalRideId">N/A</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Ride Type</div>
                            <div class="detail-value" id="modalRideType">N/A</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Status</div>
                            <div class="detail-value" id="modalRideStatus">N/A</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Total Fare</div>
                            <div class="detail-value" id="modalRideFare">K0.00</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Distance</div>
                            <div class="detail-value" id="modalRideDistance">0 km</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Duration</div>
                            <div class="detail-value" id="modalRideDuration">0 min</div>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h3 class="detail-title">Location Information</h3>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">Pickup Location</div>
                            <div class="detail-value" id="modalPickupLocation">N/A</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Destination</div>
                            <div class="detail-value" id="modalDestination">N/A</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Pickup Time</div>
                            <div class="detail-value" id="modalPickupTime">N/A</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Completion Time</div>
                            <div class="detail-value" id="modalCompletionTime">N/A</div>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h3 class="detail-title">User Information</h3>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">Passenger</div>
                            <div class="detail-value" id="modalRidePassenger">N/A</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Passenger Phone</div>
                            <div class="detail-value" id="modalRidePassengerPhone">N/A</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Driver</div>
                            <div class="detail-value" id="modalRideDriver">N/A</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Driver Phone</div>
                            <div class="detail-value" id="modalRideDriverPhone">N/A</div>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h3 class="detail-title">Fare Breakdown</h3>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">Base Fare</div>
                            <div class="detail-value" id="modalBaseFare">K0.00</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Distance Fare</div>
                            <div class="detail-value" id="modalDistanceFare">K0.00</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Surge Multiplier</div>
                            <div class="detail-value" id="modalSurgeMultiplier">1.0x</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Discount</div>
                            <div class="detail-value" id="modalDiscount">K0.00</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Platform Commission</div>
                            <div class="detail-value" id="modalCommission">K0.00</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Driver Earnings</div>
                            <div class="detail-value" id="modalDriverEarnings">K0.00</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SOS Details Modal -->
    <div class="modal-overlay" id="sosModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">SOS Alert Details</div>
                <button class="close-modal" id="closeSosModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="detail-section">
                    <h3 class="detail-title">Alert Information</h3>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">Alert ID</div>
                            <div class="detail-value" id="modalSosId">N/A</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Alert Time</div>
                            <div class="detail-value" id="modalSosTime">N/A</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Status</div>
                            <div class="detail-value" id="modalSosStatus">N/A</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Emergency Type</div>
                            <div class="detail-value" id="modalSosType">N/A</div>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h3 class="detail-title">Location Information</h3>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">Latitude</div>
                            <div class="detail-value" id="modalSosLat">N/A</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Longitude</div>
                            <div class="detail-value" id="modalSosLng">N/A</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Address</div>
                            <div class="detail-value" id="modalSosAddress">N/A</div>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h3 class="detail-title">Emergency Contacts</h3>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">Contact 1</div>
                            <div class="detail-value" id="modalContact1">N/A</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Contact 2</div>
                            <div class="detail-value" id="modalContact2">N/A</div>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h3 class="detail-title">Emergency Message</h3>
                    <div class="detail-item">
                        <div class="detail-value" id="modalSosMessage" style="background: var(--light-red); padding: 15px; border-radius: var(--element-radius);">
                            N/A
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h3 class="detail-title">Actions</h3>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" id="markResolvedBtn">
                            <i class="fas fa-check-circle"></i>
                            Mark as Resolved
                        </button>
                        <button class="btn" style="background: var(--info-blue); color: white;">
                            <i class="fas fa-phone"></i>
                            Call Emergency Services
                        </button>
                        <button class="btn" style="background: var(--warning-yellow); color: white;">
                            <i class="fas fa-envelope"></i>
                            Send Update to Contacts
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDEACX_P4c5q7djJAcA0I7Lk7leO2TlQ74",
            authDomain: "jubel-13e1a.firebaseapp.com",
            databaseURL: "https://jubel-13e1a-default-rtdb.firebaseio.com",
            projectId: "jubel-13e1a",
            storageBucket: "jubel-13e1a.firebasestorage.app",
            messagingSenderId: "882241095445",
            appId: "1:882241095445:web:ee9ca40fddd008ca910b1c",
            measurementId: "G-J5JPKL6B5F"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();

        // App state
        let currentAdmin = null;
        let driversData = [];
        let passengersData = [];
        let ridesData = [];
        let sosAlerts = [];
        let currentPage = 'dashboard';
        let currentDriverPage = 1;
        let currentPassengerPage = 1;
        let currentRidePage = 1;
        const itemsPerPage = 10;

        // Admin credentials (in production, this should be stored securely)
        const adminCredentials = {
            email: 'admin@jubel.com',
            password: 'admin123'
        };

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
        });

        // Setup event listeners
        function setupEventListeners() {
            // Login form
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const email = document.getElementById('adminEmail').value;
                const password = document.getElementById('adminPassword').value;
                
                if (email === adminCredentials.email && password === adminCredentials.password) {
                    loginAdmin();
                } else {
                    alert('Invalid credentials');
                }
            });

            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', logoutAdmin);

            // Navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    switchPage(page);
                });
            });

            // Tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });

            // Modal close buttons
            document.getElementById('closeDriverModal').addEventListener('click', () => closeModal('driverModal'));
            document.getElementById('closePassengerModal').addEventListener('click', () => closeModal('passengerModal'));
            document.getElementById('closeRideModal').addEventListener('click', () => closeModal('rideModal'));
            document.getElementById('closeSosModal').addEventListener('click', () => closeModal('sosModal'));

            // Pagination
            document.getElementById('driverPrevBtn').addEventListener('click', () => changeDriverPage(-1));
            document.getElementById('driverNextBtn').addEventListener('click', () => changeDriverPage(1));
            document.getElementById('passengerPrevBtn').addEventListener('click', () => changePassengerPage(-1));
            document.getElementById('passengerNextBtn').addEventListener('click', () => changePassengerPage(1));
            document.getElementById('ridePrevBtn').addEventListener('click', () => changeRidePage(-1));
            document.getElementById('rideNextBtn').addEventListener('click', () => changeRidePage(1));

            // Search and filter
            document.getElementById('driverSearch').addEventListener('input', filterDrivers);
            document.getElementById('driverFilter').addEventListener('change', filterDrivers);
            document.getElementById('passengerSearch').addEventListener('input', filterPassengers);
            document.getElementById('passengerFilter').addEventListener('change', filterPassengers);
            document.getElementById('rideSearch').addEventListener('input', filterRides);
            document.getElementById('rideFilter').addEventListener('change', filterRides);
            document.getElementById('rideDateFilter').addEventListener('change', filterRides);

            // Earnings filter
            document.getElementById('earningsFilter').addEventListener('change', filterEarnings);

            // SOS filter
            document.getElementById('sosFilter').addEventListener('change', filterSOS);

            // Mark resolved button
            document.getElementById('markResolvedBtn').addEventListener('click', markSOSResolved);
        }

        // Login admin
        function loginAdmin() {
            currentAdmin = {
                email: adminCredentials.email,
                name: 'Admin User'
            };
            
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'block';
            
            // Load initial data
            loadDashboardData();
            loadDrivers();
            loadPassengers();
            loadRides();
            loadSOSAlerts();
            loadEarningsData();
        }

        // Logout admin
        function logoutAdmin() {
            if (confirm('Are you sure you want to logout?')) {
                currentAdmin = null;
                document.getElementById('adminDashboard').style.display = 'none';
                document.getElementById('loginScreen').style.display = 'flex';
                
                // Reset form
                document.getElementById('loginForm').reset();
            }
        }

        // Switch between pages
        function switchPage(page) {
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`.nav-item[data-page="${page}"]`).classList.add('active');
            
            // Hide all pages
            document.querySelectorAll('.page-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(`${page}Page`).classList.add('active');
            currentPage = page;
            
            // Refresh data for current page
            switch(page) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'drivers':
                    loadDrivers();
                    break;
                case 'passengers':
                    loadPassengers();
                    break;
                case 'rides':
                    loadRides();
                    break;
                case 'earnings':
                    loadEarningsData();
                    break;
                case 'sos':
                    loadSOSAlerts();
                    break;
            }
        }

        // Switch tabs
        function switchTab(tabId) {
            // Update active tab
            const tabsContainer = event.target.closest('.tabs');
            tabsContainer.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Hide all tab contents
            const modalBody = event.target.closest('.modal-body') || document.querySelector('.tab-content').parentNode;
            modalBody.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(`${tabId}Tab`).classList.add('active');
        }

        // Load dashboard data
        function loadDashboardData() {
            // Load drivers count
            database.ref('users').orderByChild('userType').equalTo('driver').once('value')
                .then(snapshot => {
                    const drivers = snapshot.val();
                    const totalDrivers = drivers ? Object.keys(drivers).length : 0;
                    const approvedDrivers = drivers ? Object.values(drivers).filter(d => d.registrationStatus === 'approved').length : 0;
                    
                    document.getElementById('totalDrivers').textContent = totalDrivers;
                    
                    // Update stats
                    updateStats('drivers', totalDrivers, approvedDrivers);
                });

            // Load passengers count
            database.ref('users').orderByChild('userType').equalTo('passenger').once('value')
                .then(snapshot => {
                    const passengers = snapshot.val();
                    const totalPassengers = passengers ? Object.keys(passengers).length : 0;
                    
                    document.getElementById('totalPassengers').textContent = totalPassengers;
                    
                    // Update stats
                    updateStats('passengers', totalPassengers, 0);
                });

            // Load today's rides
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            database.ref('rides').once('value')
                .then(snapshot => {
                    const rides = snapshot.val();
                    let todayRides = 0;
                    let todayRevenue = 0;
                    
                    if (rides) {
                        Object.values(rides).forEach(ride => {
                            const rideDate = new Date(ride.timestamp);
                            if (rideDate >= today && ride.status === 'completed') {
                                todayRides++;
                                todayRevenue += ride.fare || 0;
                            }
                        });
                    }
                    
                    document.getElementById('totalRides').textContent = todayRides;
                    document.getElementById('totalRevenue').textContent = `K${todayRevenue.toFixed(2)}`;
                    
                    // Update recent activity
                    updateRecentActivity(rides);
                });
        }

        // Update stats with change indicators
        function updateStats(type, currentValue, previousValue) {
            const changeElement = document.getElementById(`${type}Change`);
            if (previousValue > 0) {
                const changePercent = ((currentValue - previousValue) / previousValue * 100).toFixed(1);
                if (changePercent >= 0) {
                    changeElement.innerHTML = `<i class="fas fa-arrow-up"></i> ${changePercent}% from last month`;
                    changeElement.className = 'stat-change positive';
                } else {
                    changeElement.innerHTML = `<i class="fas fa-arrow-down"></i> ${Math.abs(changePercent)}% from last month`;
                    changeElement.className = 'stat-change negative';
                }
            }
        }

        // Update recent activity
        function updateRecentActivity(rides) {
            const activityTable = document.getElementById('recentActivityTable');
            activityTable.innerHTML = '';
            
            if (rides) {
                // Get recent rides (last 10)
                const recentRides = Object.values(rides)
                    .sort((a, b) => b.timestamp - a.timestamp)
                    .slice(0, 10);
                
                recentRides.forEach(ride => {
                    const row = document.createElement('tr');
                    const date = new Date(ride.timestamp);
                    
                    row.innerHTML = `
                        <td>Ride ${ride.status}</td>
                        <td>${ride.passengerName}  ${ride.destination}</td>
                        <td>${ride.driverName || 'No driver'}</td>
                        <td>${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</td>
                        <td><span class="status-badge status-${ride.status === 'completed' ? 'approved' : 'pending'}">${ride.status}</span></td>
                    `;
                    
                    activityTable.appendChild(row);
                });
            }
        }

        // Load drivers data
        function loadDrivers() {
            database.ref('users').orderByChild('userType').equalTo('driver').once('value')
                .then(snapshot => {
                    const drivers = snapshot.val();
                    driversData = [];
                    
                    if (drivers) {
                        Object.keys(drivers).forEach(key => {
                            driversData.push({
                                id: key,
                                ...drivers[key]
                            });
                        });
                    }
                    
                    displayDrivers();
                });
        }

        // Display drivers in table
        function displayDrivers() {
            const driversTable = document.getElementById('driversTable');
            driversTable.innerHTML = '';
            
            const filteredDrivers = filterDriversData();
            const startIndex = (currentDriverPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageDrivers = filteredDrivers.slice(startIndex, endIndex);
            
            pageDrivers.forEach(driver => {
                const row = document.createElement('tr');
                const regDate = new Date(driver.createdAt);
                
                // Determine registration status badge
                let statusBadge = '';
                if (driver.registrationStatus === 'approved') {
                    statusBadge = `<span class="status-badge status-approved">Approved</span>`;
                } else if (driver.registrationStatus === 'pending') {
                    statusBadge = `<span class="status-badge status-pending">Pending</span>`;
                } else if (driver.registrationStatus === 'rejected') {
                    statusBadge = `<span class="status-badge status-rejected">Rejected</span>`;
                }
                
                // Determine online status
                let onlineBadge = '';
                if (driver.isOnline) {
                    onlineBadge = `<span class="status-badge status-online">Online</span>`;
                } else {
                    onlineBadge = `<span class="status-badge status-offline">Offline</span>`;
                }
                
                row.innerHTML = `
                    <td>${driver.id.substring(0, 8)}...</td>
                    <td>${driver.name}</td>
                    <td>${driver.phone}</td>
                    <td>${driver.vehicle ? driver.vehicle.type + ' - ' + (driver.vehicle.licensePlate || 'N/A') : 'N/A'}</td>
                    <td>${regDate.toLocaleDateString()}</td>
                    <td>
                        ${statusBadge}
                        ${onlineBadge}
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn view" onclick="viewDriver('${driver.id}')" title="View Details">
                                <i class="fas fa-eye"></i>
                            </button>
                            ${driver.registrationStatus === 'pending' ? `
                                <button class="action-btn approve" onclick="approveDriver('${driver.id}')" title="Approve">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="action-btn reject" onclick="rejectDriver('${driver.id}')" title="Reject">
                                    <i class="fas fa-times"></i>
                                </button>
                            ` : ''}
                            <button class="action-btn delete" onclick="deleteDriver('${driver.id}')" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                driversTable.appendChild(row);
            });
            
            // Update pagination
            updatePagination('driver', filteredDrivers.length);
        }

        // Filter drivers data
        function filterDriversData() {
            const searchTerm = document.getElementById('driverSearch').value.toLowerCase();
            const filterValue = document.getElementById('driverFilter').value;
            
            return driversData.filter(driver => {
                // Search filter
                const matchesSearch = !searchTerm || 
                    driver.name.toLowerCase().includes(searchTerm) ||
                    driver.phone.toLowerCase().includes(searchTerm) ||
                    (driver.vehicle && driver.vehicle.licensePlate && driver.vehicle.licensePlate.toLowerCase().includes(searchTerm));
                
                // Status filter
                let matchesFilter = true;
                switch(filterValue) {
                    case 'pending':
                        matchesFilter = driver.registrationStatus === 'pending';
                        break;
                    case 'approved':
                        matchesFilter = driver.registrationStatus === 'approved';
                        break;
                    case 'rejected':
                        matchesFilter = driver.registrationStatus === 'rejected';
                        break;
                    case 'online':
                        matchesFilter = driver.isOnline === true;
                        break;
                    case 'offline':
                        matchesFilter = driver.isOnline === false;
                        break;
                }
                
                return matchesSearch && matchesFilter;
            });
        }

        // Filter drivers (triggered by input/select change)
        function filterDrivers() {
            currentDriverPage = 1;
            displayDrivers();
        }

        // Change driver page
        function changeDriverPage(direction) {
            const filteredDrivers = filterDriversData();
            const totalPages = Math.ceil(filteredDrivers.length / itemsPerPage);
            
            currentDriverPage += direction;
            if (currentDriverPage < 1) currentDriverPage = 1;
            if (currentDriverPage > totalPages) currentDriverPage = totalPages;
            
            displayDrivers();
        }

        // Update pagination info
        function updatePagination(type, totalItems) {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            document.getElementById(`${type}PageInfo`).textContent = `Page ${currentDriverPage} of ${totalPages}`;
            
            const prevBtn = document.getElementById(`${type}PrevBtn`);
            const nextBtn = document.getElementById(`${type}NextBtn`);
            
            prevBtn.disabled = currentDriverPage === 1;
            nextBtn.disabled = currentDriverPage === totalPages;
        }

        // View driver details
        function viewDriver(driverId) {
            const driver = driversData.find(d => d.id === driverId);
            if (!driver) return;
            
            // Populate driver info
            document.getElementById('modalDriverName').textContent = driver.name || 'N/A';
            document.getElementById('modalDriverEmail').textContent = driver.email || 'N/A';
            document.getElementById('modalDriverPhone').textContent = driver.phone || 'N/A';
            document.getElementById('modalDriverNRC').textContent = driver.nrc || 'N/A';
            document.getElementById('modalDriverRegDate').textContent = driver.createdAt ? new Date(driver.createdAt).toLocaleDateString() : 'N/A';
            document.getElementById('modalDriverStatus').textContent = driver.registrationStatus || 'N/A';
            document.getElementById('modalRegStatus').textContent = driver.registrationStatus || 'N/A';
            document.getElementById('modalOnlineStatus').textContent = driver.isOnline ? 'Online' : 'Offline';
            document.getElementById('modalWalletBalance').textContent = driver.walletBalance ? `K${driver.walletBalance.toFixed(2)}` : 'K0.00';
            document.getElementById('modalFloatBalance').textContent = driver.floatBalance ? `K${driver.floatBalance.toFixed(2)}` : 'K0.00';
            
            // Populate vehicle info
            if (driver.vehicle) {
                document.getElementById('modalVehicleType').textContent = driver.vehicle.type || 'N/A';
                document.getElementById('modalVehicleMake').textContent = driver.vehicle.make || 'N/A';
                document.getElementById('modalVehicleModel').textContent = driver.vehicle.model || 'N/A';
                document.getElementById('modalLicensePlate').textContent = driver.vehicle.licensePlate || 'N/A';
                document.getElementById('modalVehicleYear').textContent = driver.vehicle.year || 'N/A';
                document.getElementById('modalVehicleColor').textContent = driver.vehicle.color || 'N/A';
            }
            
            // Load driver documents
            loadDriverDocuments(driver);
            
            // Load driver ride history
            loadDriverRides(driverId);
            
            // Show modal
            openModal('driverModal');
        }

        // Load driver documents
        function loadDriverDocuments(driver) {
            const documentsGrid = document.getElementById('driverDocumentsGrid');
            documentsGrid.innerHTML = '';
            
            if (driver.images) {
                Object.entries(driver.images).forEach(([key, url]) => {
                    if (url) {
                        const imageItem = document.createElement('div');
                        imageItem.className = 'image-item';
                        imageItem.innerHTML = `
                            <img src="${url}" alt="${key}">
                            <div class="image-label">${key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}</div>
                        `;
                        documentsGrid.appendChild(imageItem);
                    }
                });
            }
        }

        // Load driver rides
        function loadDriverRides(driverId) {
            const ridesTable = document.getElementById('modalDriverRides');
            ridesTable.innerHTML = '';
            
            database.ref('rides').orderByChild('driverId').equalTo(driverId).limitToLast(5).once('value')
                .then(snapshot => {
                    const rides = snapshot.val();
                    
                    if (rides) {
                        Object.values(rides).forEach(ride => {
                            const row = document.createElement('tr');
                            const date = new Date(ride.timestamp);
                            
                            row.innerHTML = `
                                <td>${ride.id ? ride.id.substring(0, 8) + '...' : 'N/A'}</td>
                                <td>${date.toLocaleDateString()}</td>
                                <td>${ride.passengerName || 'N/A'}</td>
                                <td>${ride.fare ? `K${ride.fare.toFixed(2)}` : 'K0.00'}</td>
                                <td><span class="status-badge status-${ride.status === 'completed' ? 'approved' : 'pending'}">${ride.status}</span></td>
                            `;
                            
                            ridesTable.appendChild(row);
                        });
                    }
                });
        }

        // Approve driver
        function approveDriver(driverId) {
            if (confirm('Are you sure you want to approve this driver?')) {
                database.ref('users/' + driverId).update({
                    registrationStatus: 'approved'
                })
                .then(() => {
                    alert('Driver approved successfully!');
                    loadDrivers();
                })
                .catch(error => {
                    alert('Error approving driver: ' + error.message);
                });
            }
        }

        // Reject driver
        function rejectDriver(driverId) {
            if (confirm('Are you sure you want to reject this driver?')) {
                database.ref('users/' + driverId).update({
                    registrationStatus: 'rejected'
                })
                .then(() => {
                    alert('Driver rejected successfully!');
                    loadDrivers();
                })
                .catch(error => {
                    alert('Error rejecting driver: ' + error.message);
                });
            }
        }

        // Delete driver
        function deleteDriver(driverId) {
            if (confirm('Are you sure you want to delete this driver? This action cannot be undone.')) {
                database.ref('users/' + driverId).remove()
                .then(() => {
                    alert('Driver deleted successfully!');
                    loadDrivers();
                    loadDashboardData();
                })
                .catch(error => {
                    alert('Error deleting driver: ' + error.message);
                });
            }
        }

        // Load passengers data
        function loadPassengers() {
            database.ref('users').orderByChild('userType').equalTo('passenger').once('value')
                .then(snapshot => {
                    const passengers = snapshot.val();
                    passengersData = [];
                    
                    if (passengers) {
                        Object.keys(passengers).forEach(key => {
                            passengersData.push({
                                id: key,
                                ...passengers[key]
                            });
                        });
                    }
                    
                    displayPassengers();
                });
        }

        // Display passengers in table
        function displayPassengers() {
            const passengersTable = document.getElementById('passengersTable');
            passengersTable.innerHTML = '';
            
            const filteredPassengers = filterPassengersData();
            const startIndex = (currentPassengerPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pagePassengers = filteredPassengers.slice(startIndex, endIndex);
            
            pagePassengers.forEach(passenger => {
                const row = document.createElement('tr');
                const joinDate = new Date(passenger.createdAt);
                
                // Count total rides for this passenger
                let totalRides = 0;
                if (ridesData.length > 0) {
                    totalRides = ridesData.filter(ride => ride.passengerId === passenger.id).length;
                }
                
                row.innerHTML = `
                    <td>${passenger.id.substring(0, 8)}...</td>
                    <td>${passenger.name}</td>
                    <td>${passenger.email}</td>
                    <td>${passenger.phone}</td>
                    <td>${totalRides}</td>
                    <td>${joinDate.toLocaleDateString()}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn view" onclick="viewPassenger('${passenger.id}')" title="View Details">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="action-btn delete" onclick="deletePassenger('${passenger.id}')" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                passengersTable.appendChild(row);
            });
            
            // Update pagination
            updatePassengerPagination(filteredPassengers.length);
        }

        // Filter passengers data
        function filterPassengersData() {
            const searchTerm = document.getElementById('passengerSearch').value.toLowerCase();
            const filterValue = document.getElementById('passengerFilter').value;
            
            return passengersData.filter(passenger => {
                // Search filter
                const matchesSearch = !searchTerm || 
                    passenger.name.toLowerCase().includes(searchTerm) ||
                    passenger.email.toLowerCase().includes(searchTerm) ||
                    passenger.phone.toLowerCase().includes(searchTerm);
                
                // Status filter (simplified - active/inactive based on last login)
                let matchesFilter = true;
                if (filterValue === 'active') {
                    // Consider active if they have logged in within last 30 days
                    const lastLogin = passenger.lastLogin ? new Date(passenger.lastLogin) : null;
                    const thirtyDaysAgo = new Date();
                    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                    matchesFilter = lastLogin && lastLogin > thirtyDaysAgo;
                } else if (filterValue === 'inactive') {
                    const lastLogin = passenger.lastLogin ? new Date(passenger.lastLogin) : null;
                    const thirtyDaysAgo = new Date();
                    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                    matchesFilter = !lastLogin || lastLogin <= thirtyDaysAgo;
                }
                
                return matchesSearch && matchesFilter;
            });
        }

        // Filter passengers (triggered by input/select change)
        function filterPassengers() {
            currentPassengerPage = 1;
            displayPassengers();
        }

        // Change passenger page
        function changePassengerPage(direction) {
            const filteredPassengers = filterPassengersData();
            const totalPages = Math.ceil(filteredPassengers.length / itemsPerPage);
            
            currentPassengerPage += direction;
            if (currentPassengerPage < 1) currentPassengerPage = 1;
            if (currentPassengerPage > totalPages) currentPassengerPage = totalPages;
            
            displayPassengers();
        }

        // Update passenger pagination
        function updatePassengerPagination(totalItems) {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            document.getElementById('passengerPageInfo').textContent = `Page ${currentPassengerPage} of ${totalPages}`;
            
            const prevBtn = document.getElementById('passengerPrevBtn');
            const nextBtn = document.getElementById('passengerNextBtn');
            
            prevBtn.disabled = currentPassengerPage === 1;
            nextBtn.disabled = currentPassengerPage === totalPages;
        }

        // View passenger details
        function viewPassenger(passengerId) {
            const passenger = passengersData.find(p => p.id === passengerId);
            if (!passenger) return;
            
            // Populate passenger info
            document.getElementById('modalPassengerName').textContent = passenger.name || 'N/A';
            document.getElementById('modalPassengerEmail').textContent = passenger.email || 'N/A';
            document.getElementById('modalPassengerPhone').textContent = passenger.phone || 'N/A';
            document.getElementById('modalPassengerJoinDate').textContent = passenger.createdAt ? new Date(passenger.createdAt).toLocaleDateString() : 'N/A';
            
            // Calculate total rides and rating
            let totalRides = 0;
            let totalRating = 0;
            let ratingCount = 0;
            
            if (ridesData.length > 0) {
                const passengerRides = ridesData.filter(ride => ride.passengerId === passengerId);
                totalRides = passengerRides.length;
                
                // Calculate average rating (if available)
                passengerRides.forEach(ride => {
                    if (ride.passengerRating) {
                        totalRating += ride.passengerRating;
                        ratingCount++;
                    }
                });
            }
            
            document.getElementById('modalPassengerTotalRides').textContent = totalRides;
            document.getElementById('modalPassengerRating').textContent = ratingCount > 0 ? (totalRating / ratingCount).toFixed(1) : '0.0';
            
            // Load passenger rides
            loadPassengerRides(passengerId);
            
            // Show modal
            openModal('passengerModal');
        }

        // Load passenger rides
        function loadPassengerRides(passengerId) {
            const ridesTable = document.getElementById('modalPassengerRides');
            ridesTable.innerHTML = '';
            
            database.ref('rides').orderByChild('passengerId').equalTo(passengerId).limitToLast(5).once('value')
                .then(snapshot => {
                    const rides = snapshot.val();
                    
                    if (rides) {
                        Object.values(rides).forEach(ride => {
                            const row = document.createElement('tr');
                            const date = new Date(ride.timestamp);
                            
                            row.innerHTML = `
                                <td>${ride.id ? ride.id.substring(0, 8) + '...' : 'N/A'}</td>
                                <td>${date.toLocaleDateString()}</td>
                                <td>${ride.driverName || 'N/A'}</td>
                                <td>${ride.rideType || 'N/A'}</td>
                                <td>${ride.fare ? `K${ride.fare.toFixed(2)}` : 'K0.00'}</td>
                                <td><span class="status-badge status-${ride.status === 'completed' ? 'approved' : 'pending'}">${ride.status}</span></td>
                            `;
                            
                            ridesTable.appendChild(row);
                        });
                    }
                });
        }

        // Delete passenger
        function deletePassenger(passengerId) {
            if (confirm('Are you sure you want to delete this passenger? This action cannot be undone.')) {
                database.ref('users/' + passengerId).remove()
                .then(() => {
                    alert('Passenger deleted successfully!');
                    loadPassengers();
                    loadDashboardData();
                })
                .catch(error => {
                    alert('Error deleting passenger: ' + error.message);
                });
            }
        }

        // Load rides data
        function loadRides() {
            database.ref('rides').once('value')
                .then(snapshot => {
                    const rides = snapshot.val();
                    ridesData = [];
                    
                    if (rides) {
                        Object.keys(rides).forEach(key => {
                            ridesData.push({
                                id: key,
                                ...rides[key]
                            });
                        });
                    }
                    
                    displayRides();
                });
        }

        // Display rides in table
        function displayRides() {
            const ridesTable = document.getElementById('ridesTable');
            ridesTable.innerHTML = '';
            
            const filteredRides = filterRidesData();
            const startIndex = (currentRidePage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageRides = filteredRides.slice(startIndex, endIndex);
            
            pageRides.forEach(ride => {
                const row = document.createElement('tr');
                const date = new Date(ride.timestamp);
                
                // Status badge
                let statusClass = 'pending';
                if (ride.status === 'completed') statusClass = 'approved';
                if (ride.status === 'cancelled') statusClass = 'rejected';
                
                row.innerHTML = `
                    <td>${ride.id.substring(0, 8)}...</td>
                    <td>${ride.passengerName || 'N/A'}</td>
                    <td>${ride.driverName || 'No driver assigned'}</td>
                    <td>${ride.pickupDisplayLocation || ride.pickupLocation || 'N/A'}</td>
                    <td>${ride.destination || 'N/A'}</td>
                    <td>${ride.fare ? `K${ride.fare.toFixed(2)}` : 'K0.00'}</td>
                    <td>${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</td>
                    <td><span class="status-badge status-${statusClass}">${ride.status}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn view" onclick="viewRide('${ride.id}')" title="View Details">
                                <i class="fas fa-eye"></i>
                            </button>
                            ${ride.status === 'requested' ? `
                                <button class="action-btn edit" onclick="assignDriver('${ride.id}')" title="Assign Driver">
                                    <i class="fas fa-user-plus"></i>
                                </button>
                            ` : ''}
                            <button class="action-btn delete" onclick="deleteRide('${ride.id}')" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                ridesTable.appendChild(row);
            });
            
            // Update pagination
            updateRidePagination(filteredRides.length);
        }

        // Filter rides data
        function filterRidesData() {
            const searchTerm = document.getElementById('rideSearch').value.toLowerCase();
            const filterValue = document.getElementById('rideFilter').value;
            const dateFilter = document.getElementById('rideDateFilter').value;
            
            return ridesData.filter(ride => {
                // Search filter
                const matchesSearch = !searchTerm || 
                    (ride.passengerName && ride.passengerName.toLowerCase().includes(searchTerm)) ||
                    (ride.driverName && ride.driverName.toLowerCase().includes(searchTerm)) ||
                    (ride.pickupLocation && ride.pickupLocation.toLowerCase().includes(searchTerm)) ||
                    (ride.destination && ride.destination.toLowerCase().includes(searchTerm));
                
                // Status filter
                let matchesFilter = true;
                if (filterValue !== 'all') {
                    matchesFilter = ride.status === filterValue;
                }
                
                // Date filter
                let matchesDate = true;
                if (dateFilter) {
                    const rideDate = new Date(ride.timestamp);
                    const filterDate = new Date(dateFilter);
                    matchesDate = rideDate.toDateString() === filterDate.toDateString();
                }
                
                return matchesSearch && matchesFilter && matchesDate;
            });
        }

        // Filter rides (triggered by input/select change)
        function filterRides() {
            currentRidePage = 1;
            displayRides();
        }

        // Change ride page
        function changeRidePage(direction) {
            const filteredRides = filterRidesData();
            const totalPages = Math.ceil(filteredRides.length / itemsPerPage);
            
            currentRidePage += direction;
            if (currentRidePage < 1) currentRidePage = 1;
            if (currentRidePage > totalPages) currentRidePage = totalPages;
            
            displayRides();
        }

        // Update ride pagination
        function updateRidePagination(totalItems) {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            document.getElementById('ridePageInfo').textContent = `Page ${currentRidePage} of ${totalPages}`;
            
            const prevBtn = document.getElementById('ridePrevBtn');
            const nextBtn = document.getElementById('rideNextBtn');
            
            prevBtn.disabled = currentRidePage === 1;
            nextBtn.disabled = currentRidePage === totalPages;
        }

        // View ride details
        function viewRide(rideId) {
            const ride = ridesData.find(r => r.id === rideId);
            if (!ride) return;
            
            // Populate ride info
            document.getElementById('modalRideId').textContent = ride.id || 'N/A';
            document.getElementById('modalRideType').textContent = ride.rideType || 'N/A';
            document.getElementById('modalRideStatus').textContent = ride.status || 'N/A';
            document.getElementById('modalRideFare').textContent = ride.fare ? `K${ride.fare.toFixed(2)}` : 'K0.00';
            document.getElementById('modalRideDistance').textContent = ride.distance ? `${ride.distance} km` : 'N/A';
            document.getElementById('modalRideDuration').textContent = ride.estimatedTime || 'N/A';
            document.getElementById('modalPickupLocation').textContent = ride.pickupDisplayLocation || ride.pickupLocation || 'N/A';
            document.getElementById('modalDestination').textContent = ride.destination || 'N/A';
            document.getElementById('modalPickupTime').textContent = ride.timestamp ? new Date(ride.timestamp).toLocaleString() : 'N/A';
            document.getElementById('modalCompletionTime').textContent = ride.completedAt ? new Date(ride.completedAt).toLocaleString() : 'N/A';
            document.getElementById('modalRidePassenger').textContent = ride.passengerName || 'N/A';
            document.getElementById('modalRidePassengerPhone').textContent = ride.passengerPhone || 'N/A';
            document.getElementById('modalRideDriver').textContent = ride.driverName || 'N/A';
            document.getElementById('modalRideDriverPhone').textContent = ride.driverPhone || 'N/A';
            
            // Fare breakdown
            const baseFare = ride.fare || 0;
            const commission = baseFare * 0.08; // 8% commission
            const driverEarnings = baseFare - commission;
            
            document.getElementById('modalBaseFare').textContent = `K${baseFare.toFixed(2)}`;
            document.getElementById('modalDistanceFare').textContent = 'K0.00'; // Simplified
            document.getElementById('modalSurgeMultiplier').textContent = ride.surgeMultiplier || '1.0x';
            document.getElementById('modalDiscount').textContent = ride.promoCode ? 'K' + (baseFare * 0.2).toFixed(2) : 'K0.00';
            document.getElementById('modalCommission').textContent = `K${commission.toFixed(2)}`;
            document.getElementById('modalDriverEarnings').textContent = `K${driverEarnings.toFixed(2)}`;
            
            // Show modal
            openModal('rideModal');
        }

        // Assign driver to ride
        function assignDriver(rideId) {
            // In a real app, this would show a list of available drivers
            const driverId = prompt('Enter Driver ID to assign:');
            if (driverId) {
                // Get driver details
                database.ref('users/' + driverId).once('value')
                    .then(snapshot => {
                        const driver = snapshot.val();
                        if (driver && driver.userType === 'driver') {
                            // Assign driver to ride
                            return database.ref('rides/' + rideId).update({
                                driverId: driverId,
                                driverName: driver.name,
                                driverPhone: driver.phone,
                                status: 'accepted',
                                acceptedAt: firebase.database.ServerValue.TIMESTAMP
                            });
                        } else {
                            throw new Error('Invalid driver ID');
                        }
                    })
                    .then(() => {
                        alert('Driver assigned successfully!');
                        loadRides();
                    })
                    .catch(error => {
                        alert('Error assigning driver: ' + error.message);
                    });
            }
        }

        // Delete ride
        function deleteRide(rideId) {
            if (confirm('Are you sure you want to delete this ride? This action cannot be undone.')) {
                database.ref('rides/' + rideId).remove()
                .then(() => {
                    alert('Ride deleted successfully!');
                    loadRides();
                    loadDashboardData();
                })
                .catch(error => {
                    alert('Error deleting ride: ' + error.message);
                });
            }
        }

        // Load earnings data
        function loadEarningsData() {
            // Calculate total platform earnings
            let totalEarnings = 0;
            let todayCommission = 0;
            let monthCommission = 0;
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            
            if (ridesData.length > 0) {
                ridesData.forEach(ride => {
                    if (ride.status === 'completed' && ride.fare) {
                        const rideDate = new Date(ride.timestamp);
                        const commission = ride.fare * 0.08; // 8% commission
                        
                        totalEarnings += ride.fare;
                        
                        if (rideDate >= today) {
                            todayCommission += commission;
                        }
                        
                        if (rideDate >= firstDayOfMonth) {
                            monthCommission += commission;
                        }
                    }
                });
            }
            
            document.getElementById('totalPlatformEarnings').textContent = `K${totalEarnings.toFixed(2)}`;
            document.getElementById('todayCommission').textContent = `K${todayCommission.toFixed(2)}`;
            document.getElementById('monthCommission').textContent = `K${monthCommission.toFixed(2)}`;
            
            // Load driver earnings
            loadDriverEarnings();
        }

        // Load driver earnings
        function loadDriverEarnings() {
            const earningsTable = document.getElementById('earningsTable');
            earningsTable.innerHTML = '';
            
            // Get all drivers
            database.ref('users').orderByChild('userType').equalTo('driver').once('value')
                .then(snapshot => {
                    const drivers = snapshot.val();
                    
                    if (drivers) {
                        Object.entries(drivers).forEach(([driverId, driver]) => {
                            // Get driver's rides
                            database.ref('rides').orderByChild('driverId').equalTo(driverId).once('value')
                                .then(ridesSnapshot => {
                                    const rides = ridesSnapshot.val();
                                    let totalRides = 0;
                                    let totalEarnings = 0;
                                    let totalCommission = 0;
                                    let averageRating = 0;
                                    let ratingCount = 0;
                                    
                                    if (rides) {
                                        Object.values(rides).forEach(ride => {
                                            if (ride.status === 'completed') {
                                                totalRides++;
                                                totalEarnings += (ride.fare || 0);
                                                totalCommission += (ride.fare || 0) * 0.08;
                                                
                                                if (ride.driverRating) {
                                                    averageRating += ride.driverRating;
                                                    ratingCount++;
                                                }
                                            }
                                        });
                                    }
                                    
                                    const netEarnings = totalEarnings - totalCommission;
                                    const avgRating = ratingCount > 0 ? (averageRating / ratingCount).toFixed(1) : '0.0';
                                    
                                    const row = document.createElement('tr');
                                    row.innerHTML = `
                                        <td>${driver.name}</td>
                                        <td>${totalRides}</td>
                                        <td>K${totalEarnings.toFixed(2)}</td>
                                        <td>K${totalCommission.toFixed(2)}</td>
                                        <td>K${netEarnings.toFixed(2)}</td>
                                        <td>${avgRating} </td>
                                    `;
                                    
                                    earningsTable.appendChild(row);
                                });
                        });
                    }
                });
        }

        // Filter earnings
        function filterEarnings() {
            // This would filter earnings by period
            loadEarningsData();
        }

        // Load SOS alerts
        function loadSOSAlerts() {
            database.ref('sosAlerts').once('value')
                .then(snapshot => {
                    const alerts = snapshot.val();
                    sosAlerts = [];
                    
                    if (alerts) {
                        Object.keys(alerts).forEach(key => {
                            sosAlerts.push({
                                id: key,
                                ...alerts[key]
                            });
                        });
                    }
                    
                    displaySOSAlerts();
                });
        }

        // Display SOS alerts
        function displaySOSAlerts() {
            const sosTable = document.getElementById('sosTable');
            sosTable.innerHTML = '';
            
            const filteredAlerts = filterSOSData();
            
            filteredAlerts.forEach(alert => {
                const row = document.createElement('tr');
                const alertTime = new Date(alert.timestamp);
                
                // Status badge
                let statusClass = 'pending';
                if (alert.status === 'resolved') statusClass = 'approved';
                if (alert.status === 'active') statusClass = 'rejected';
                
                row.innerHTML = `
                    <td>${alert.id.substring(0, 8)}...</td>
                    <td>${alert.driverName || 'N/A'}</td>
                    <td>${alert.passengerDetails ? alert.passengerDetails.name : 'N/A'}</td>
                    <td>${alertTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</td>
                    <td><span class="status-badge status-${statusClass}">${alert.status || 'active'}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn view" onclick="viewSOSAlert('${alert.id}')" title="View Details">
                                <i class="fas fa-eye"></i>
                            </button>
                            ${alert.status !== 'resolved' ? `
                                <button class="action-btn approve" onclick="resolveSOSAlert('${alert.id}')" title="Mark Resolved">
                                    <i class="fas fa-check"></i>
                                </button>
                            ` : ''}
                        </div>
                    </td>
                `;
                
                sosTable.appendChild(row);
            });
        }

        // Filter SOS data
        function filterSOSData() {
            const filterValue = document.getElementById('sosFilter').value;
            
            if (filterValue === 'all') {
                return sosAlerts;
            } else {
                return sosAlerts.filter(alert => alert.status === filterValue);
            }
        }

        // Filter SOS alerts
        function filterSOS() {
            displaySOSAlerts();
        }

        // View SOS alert details
        function viewSOSAlert(alertId) {
            const alert = sosAlerts.find(a => a.id === alertId);
            if (!alert) return;
            
            // Populate alert info
            document.getElementById('modalSosId').textContent = alert.id || 'N/A';
            document.getElementById('modalSosTime').textContent = alert.timestamp ? new Date(alert.timestamp).toLocaleString() : 'N/A';
            document.getElementById('modalSosStatus').textContent = alert.status || 'active';
            document.getElementById('modalSosType').textContent = alert.type || 'N/A';
            
            if (alert.location) {
                document.getElementById('modalSosLat').textContent = alert.location.lat || 'N/A';
                document.getElementById('modalSosLng').textContent = alert.location.lng || 'N/A';
                // In a real app, you would geocode lat/lng to get address
                document.getElementById('modalSosAddress').textContent = 'Location coordinates available';
            }
            
            if (alert.emergencyContacts) {
                document.getElementById('modalContact1').textContent = alert.emergencyContacts.contact1 || 'N/A';
                document.getElementById('modalContact2').textContent = alert.emergencyContacts.contact2 || 'N/A';
            }
            
            document.getElementById('modalSosMessage').textContent = alert.message || 'N/A';
            
            // Show modal
            openModal('sosModal');
        }

        // Resolve SOS alert
        function resolveSOSAlert(alertId) {
            database.ref('sosAlerts/' + alertId).update({
                status: 'resolved',
                resolvedAt: firebase.database.ServerValue.TIMESTAMP,
                resolvedBy: currentAdmin.name
            })
            .then(() => {
                alert('SOS alert marked as resolved!');
                loadSOSAlerts();
                closeModal('sosModal');
            })
            .catch(error => {
                alert('Error resolving SOS alert: ' + error.message);
            });
        }

        // Mark SOS resolved from modal
        function markSOSResolved() {
            const alertId = document.getElementById('modalSosId').textContent;
            if (alertId && alertId !== 'N/A') {
                resolveSOSAlert(alertId);
            }
        }

        // Open modal
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Utility function to format date
        function formatDate(date) {
            return new Date(date).toLocaleDateString();
        }

        // Utility function to format time
        function formatTime(date) {
            return new Date(date).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }
    </script>
</body>
</html>
